# 課題
jestで単体テストを書こう 課題3

## 課題3-1
課題2の単体テストを書くためには、依存性の注入とモック化を行う必要がありました。
そもそも、なぜ元の関数はカバレッジ100%のテストを書けなかったのでしょうか？

- 実行結果が一定でない処理が存在し、すべての文を実行されることが保証できないため

## 課題3-2
依存性の注入とは何でしょうか？どのような問題を解決するために考案されたのでしょうか？

- モジュールの定義時には、抽象に依存し、実行時に具象への依存をモジュールに注入すること
- モジュール間を疎結合に保ち、変更容易性を高めることができる

## 課題3-3
getFirstNameThrowIfLongの関数はhttps://random-data-api.comからデータを取得しているようです。しかしテストの度に外部サービスと通信をするようでは、良い単体テストにならない可能性があります。今回のような単体テストで外部サービスとの通信が発生すると、どのようなデメリットがあるでしょうか？
- 通信による処理の結果が安定しないため、テストが失敗しやすい
- テストの実行時間が増加する

## 課題3-4
テストには「単体テスト」「統合テスト」など様々な分類や定義があります。
チーム内で「何を単体テストと呼ぶのか」「何を統合テストと呼ぶのか」など用語の定義集を作ってみても面白いかもしれません。
- 単体テスト
    - 単体で動作するコンポーネントごとに行うテスト
    - ウォーターフォール型開発の場合、詳細設計に対応
- 結合テスト
    - 複数のコンポーネントを組み合わせて動作を確認するテスト
    - ウォーターフォール型開発の場合、基本設計に対応
- 統合テスト（システムテスト）
    - 個々のコンポーネントを統合した状態で、要件定義の内容が実現されているかを確認するテスト
    - ウォーターフォール型開発の場合、要件定義に対応
- 受け入れテスト
    - 発注者によるテスト
    - ウォーターフォール型開発の場合、要求定義に対応

## 課題3-5
sumOfArrayに空の配列を渡すと例外が発生します。あまり好ましい挙動ではありません。
なぜあまり好ましい挙動ではないのでしょうか？
「こうなるべきだ」とご自身が考える形にコードを修正してみてください。

- 直感に反するため
    - 例えばPythonのsum関数では例外の代わりに0を返す
- sumOfArrayに空の配列を渡した時に0を返却するよう修正した

## 課題3-6
コードを修正したら、先ほど書いた単体テストが落ちるはずです。
全ての単体テストが通るよう、単体テストも修正してください。

- functions.test.tsの該当テストを修正した

## 課題3-7
単体テストを作成する際は、挙動が変わる境界値を検討したり、テストで保証しなければならない挙動を開発者自身が事前に考えておく必要があります。しかし複雑な機能をテストする場合あらかじめ全てのテストケースを開発者が想定しきることは難しいかもしれません。

「この特定の値の時だけ不具合が起きる」ケースを開発者が見落としてしまうと、テストケースが不完全になってしまいます。そんな時に役立つかもしれない概念として「Property Based Testing（プロパティベースのテスト）」があります（対照的な存在としてはExample Based Testingが挙げられます）。

なぜこのテストの考え方がコード品質を向上してくれる可能性があるのでしょうか？
逆に採用しない方が良いケースはあるのでしょうか？

- なぜProperty Based Testingの考え方がコード品質を向上してくれる可能性があるか
    - 開発者が想定できなかったケースを見つけることが可能になる
- 採用しない方が良いケース
    - シンプルな機能の場合、実行時間や学習コストを考慮すると過剰な可能性がある

## 課題3-8
単体テストケースを増やしても可読性、保守性、実行速度などに問題が起きないよう工夫できることを3つ考えてみましょう。

- 並列実行しても問題ないようにするため、テスト同士の依存関係を作らないようにする
- Given-When-Thenパターンを使用し、可読性を高める
- 1つのテスト関数の中で複数のテストをしない